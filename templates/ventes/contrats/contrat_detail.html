{% extends 'base/base.html' %}
{% load static %}

{% block extra_css %}
<style>
    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
    }
    
    .detail-container { 
        max-width: 1400px; 
        margin: 2rem auto; 
        padding: 0 1.5rem; 
    }
    
    .back-button {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.25rem;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        color: white;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 600;
        margin-bottom: 1.5rem;
        transition: all 0.3s;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .back-button:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateX(-5px);
    }
    
    .header-card { 
        background: white; 
        border-radius: 20px; 
        padding: 2rem; 
        margin-bottom: 2rem; 
        box-shadow: 0 20px 60px rgba(0,0,0,0.2); 
    }
    
    .header-content { 
        display: flex; 
        justify-content: space-between; 
        align-items: start; 
        flex-wrap: wrap; 
        gap: 1.5rem; 
    }
    
    .header-left h1 { 
        margin: 0 0 0.5rem 0; 
        font-size: 1.75rem; 
        color: #1f2937; 
    }
    
    .header-meta { 
        display: flex; 
        gap: 1rem; 
        flex-wrap: wrap; 
    }
    
    .meta-badge { 
        padding: 0.5rem 1rem; 
        background: #f3f4f6; 
        border-radius: 8px; 
        font-size: 0.85rem; 
    }
    
    .status-badge { 
        padding: 0.5rem 1rem; 
        border-radius: 20px; 
        font-weight: 600; 
        font-size: 0.85rem; 
    }
    
    .status-badge.planifie { background: #dbeafe; color: #1e40af; }
    .status-badge.en_cours { background: #fef3c7; color: #78350f; }
    .status-badge.termine { background: #d1fae5; color: #065f46; }
    .status-badge.annule { background: #fee2e2; color: #991b1b; }
    
    .action-buttons { 
        display: flex; 
        gap: 0.75rem; 
    }
    
    .btn { 
        padding: 0.75rem 1.25rem; 
        border-radius: 10px; 
        font-weight: 600; 
        cursor: pointer; 
        border: none; 
        transition: all 0.3s; 
        text-decoration: none; 
        display: inline-flex; 
        align-items: center; 
        gap: 0.5rem; 
        font-size: 0.9rem; 
    }
    
    .btn-primary { 
        background: #6366f1; 
        color: white; 
    }
    
    .btn-primary:hover { 
        background: #4f46e5; 
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
    }
    
    .btn-danger { 
        background: #ef4444; 
        color: white; 
    }
    
    .btn-danger:hover { 
        background: #dc2626; 
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
    }
    
    .btn-secondary { 
        background: #f3f4f6; 
        color: #374151; 
    }
    
    .btn-secondary:hover { 
        background: #e5e7eb; 
    }
    
    .content-grid { 
        display: grid; 
        grid-template-columns: 2fr 1fr; 
        gap: 2rem; 
    }
    
    .main-content { 
        display: flex; 
        flex-direction: column; 
        gap: 2rem; 
    }
    
    .sidebar { 
        display: flex; 
        flex-direction: column; 
        gap: 2rem; 
    }
    
    .card { 
        background: white; 
        border-radius: 20px; 
        padding: 2rem; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.15); 
        transition: all 0.3s;
    }
    
    .card:hover {
        box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        transform: translateY(-2px);
    }
    
    .card-title { 
        font-size: 1.25rem; 
        font-weight: 700; 
        margin-bottom: 1.5rem; 
        color: #1f2937; 
        display: flex; 
        align-items: center; 
        gap: 0.5rem; 
    }
    
    .info-grid { 
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        gap: 1.5rem; 
    }
    
    .info-item { 
        display: flex; 
        flex-direction: column; 
        gap: 0.25rem; 
    }
    
    .info-label { 
        font-size: 0.85rem; 
        font-weight: 600; 
        color: #6b7280; 
    }
    
    .info-value { 
        font-size: 0.95rem; 
        color: #1f2937; 
    }
    
    .deroule-box { 
        background: #f9fafb; 
        padding: 1.5rem; 
        border-radius: 10px; 
        white-space: pre-wrap; 
        font-size: 0.95rem; 
        line-height: 1.6; 
        color: #374151; 
    }
    
    .timeline-item { 
        padding-left: 2rem; 
        position: relative; 
        padding-bottom: 1.5rem; 
        border-left: 2px solid #e5e7eb; 
    }
    
    .timeline-item:last-child { 
        border-left: none; 
        padding-bottom: 0; 
    }
    
    .timeline-dot { 
        width: 12px; 
        height: 12px; 
        background: #6366f1; 
        border-radius: 50%; 
        position: absolute; 
        left: -7px; 
        top: 0; 
    }
    
    .timeline-time { 
        font-size: 0.75rem; 
        color: #6b7280; 
        margin-bottom: 0.25rem; 
    }
    
    .timeline-content { 
        font-size: 0.9rem; 
        color: #1f2937; 
    }
    
    .photo-grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); 
        gap: 1rem; 
    }
    
    .photo-item { 
        aspect-ratio: 1; 
        border-radius: 10px; 
        overflow: hidden; 
        cursor: pointer; 
        transition: all 0.3s; 
    }
    
    .photo-item:hover { 
        transform: scale(1.05); 
        box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    .photo-item img { 
        width: 100%; 
        height: 100%; 
        object-fit: cover; 
    }
    
    .empty-state {
        text-align: center;
        padding: 2rem;
        color: #6b7280;
    }
    
    .empty-state svg {
        width: 48px;
        height: 48px;
        margin: 0 auto 1rem;
        opacity: 0.5;
    }
    
    @media (max-width: 1024px) {
        .content-grid { grid-template-columns: 1fr; }
        .info-grid { grid-template-columns: 1fr; }
    }
</style>
{% endblock %}

{% block content %}
<div class="detail-container">
    <!-- Bouton retour -->
     {% if request.user.role == 'resp_ventes' %}
    <a href="{% url 'ventes:dashboard_responsable' %}" class="back-button">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        Retour au tableau de bord
    </a>
    {% else %}
    <a href="{% url 'ventes:dashboard_vendeuse' %}" class="back-button">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        Retour au tableau de bord
    </a>
    {% endif %}
    <!-- En-t√™te -->
    <div class="header-card">
        <div class="header-content">
            <div class="header-left">
                <h1>üìã {{ contrat.numero_contrat }}</h1>
                <h2 style="margin: 0; font-size: 1.25rem; color: #6b7280; font-weight: 400;">
                    {{ contrat.nom_evenement }}
                </h2>
                <div class="header-meta" style="margin-top: 1rem;">
                    <span class="status-badge {{ contrat.status }}">
                        {{ contrat.get_status_display }}
                    </span>
                    <span class="meta-badge">
                        üìÖ {{ contrat.date_evenement|date:"d/m/Y" }}
                    </span>
                    <span class="meta-badge">
                        ‚è∞ {{ contrat.heure_debut_prevue|time:"H:i" }} - {{ contrat.heure_fin_prevue|time:"H:i" }}
                    </span>
                    {% if contrat.nb_convives %}
                    <span class="meta-badge">
                        üë• {{ contrat.nb_convives }} convives
                    </span>
                    {% endif %}
                </div>
            </div>
            
            {% if can_edit %}
            <div class="action-buttons">
                <a href="{% url 'ventes:contrat_edit' contrat.pk %}" class="btn btn-primary">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                    Modifier
                </a>
                <a href="{% url 'ventes:contrat_delete' contrat.pk %}" class="btn btn-danger">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                    Supprimer
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Contenu principal -->
    <div class="content-grid">
        <!-- Colonne principale -->
        <div class="main-content">
            <!-- Informations g√©n√©rales -->
            <div class="card">
                <h3 class="card-title">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Informations g√©n√©rales
                </h3>
                
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Client</div>
                        <div class="info-value">{{ contrat.client_nom }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">T√©l√©phone</div>
                        <div class="info-value">{{ contrat.client_telephone }}</div>
                    </div>
                    {% if contrat.client_email %}
                    <div class="info-item">
                        <div class="info-label">Email</div>
                        <div class="info-value">{{ contrat.client_email }}</div>
                    </div>
                    {% endif %}
                    {% if contrat.contact_sur_site %}
                    <div class="info-item">
                        <div class="info-label">Contact sur site</div>
                        <div class="info-value">{{ contrat.contact_sur_site }}</div>
                    </div>
                    {% endif %}
                    <div class="info-item">
                        <div class="info-label">Adresse</div>
                        <div class="info-value">{{ contrat.adresse_complete }}, {{ contrat.ville }}</div>
                    </div>
                    {% if contrat.maitre_hotel %}
                    <div class="info-item">
                        <div class="info-label">Ma√Ætre d'h√¥tel</div>
                        <div class="info-value">{{ contrat.maitre_hotel.get_full_name }}</div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- D√©roul√© de l'√©v√©nement -->
            {% if contrat.deroule_evenement %}
            <div class="card">
                <h3 class="card-title">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    D√©roul√© de l'√©v√©nement
                </h3>
                <div class="deroule-box">{{ contrat.deroule_evenement }}</div>
            </div>
            {% endif %}

            <!-- Informations suppl√©mentaires -->
            {% if contrat.informations_supplementaires or contrat.instructions_speciales %}
            <div class="card">
                <h3 class="card-title">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
                    </svg>
                    Notes & Instructions
                </h3>
                
                {% if contrat.informations_supplementaires %}
                <div style="margin-bottom: 1rem;">
                    <div class="info-label">Informations suppl√©mentaires</div>
                    <div class="deroule-box" style="margin-top: 0.5rem;">{{ contrat.informations_supplementaires }}</div>
                </div>
                {% endif %}
                
                {% if contrat.instructions_speciales %}
                <div>
                    <div class="info-label">Instructions sp√©ciales</div>
                    <div class="deroule-box" style="margin-top: 0.5rem;">{{ contrat.instructions_speciales }}</div>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Photos -->
            {% if photos %}
            <div class="card">
                <h3 class="card-title">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    Photos ({{ photos.count }})
                </h3>
                
                <div class="photo-grid">
                    {% for photo in photos %}
                    <div class="photo-item">
                        <img src="{{ photo.image.url }}" alt="{{ photo.legende }}">
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Associations -->
            <div class="card">
                <h3 class="card-title">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                    </svg>
                    Associations
                </h3>
                
                {% if contrat.checklist %}
                <div class="info-item" style="margin-bottom: 1rem;">
                    <div class="info-label">‚úÖ Checklist</div>
                    <a href="{% url 'ventes:checklist_detail' contrat.checklist.pk %}" class="info-value" style="color: #6366f1; text-decoration: none; font-weight: 600;">
                        {{ contrat.checklist.numero_commande }}
                    </a>
                </div>
                {% else %}
                <div class="info-item" style="margin-bottom: 1rem;">
                    <div class="info-label">‚úÖ Checklist</div>
                    <div class="info-value" style="color: #9ca3af; font-style: italic;">Non li√©e</div>
                </div>
                {% endif %}
                
                {% if contrat.livraison %}
                <div class="info-item">
                    <div class="info-label">üöö Livraison</div>
                    <a href="#" class="info-value" style="color: #6366f1; text-decoration: none; font-weight: 600;">
                        {{ contrat.livraison.numero_livraison }}
                    </a>
                </div>
                {% else %}
                <div class="info-item">
                    <div class="info-label">üöö Livraison</div>
                    <div class="info-value" style="color: #9ca3af; font-style: italic;">Non li√©e</div>
                </div>
                {% endif %}
            </div>

            <!-- Historique -->
            {% if historique %}
            <div class="card">
                <h3 class="card-title">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Historique r√©cent
                </h3>
                
                <div style="margin-top: 1rem;">
                    {% for entry in historique %}
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-time">{{ entry.date_action|date:"d/m/Y H:i" }}</div>
                        <div class="timeline-content">
                            <strong>{{ entry.get_type_action_display }}</strong>
                            {% if entry.effectue_par %}
                            <br><span style="color: #6b7280;">Par {{ entry.effectue_par.get_full_name|default:entry.effectue_par.username }}</span>
                            {% endif %}
                            {% if entry.description %}
                            <br><span style="color: #6b7280;">{{ entry.description }}</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- M√©tadonn√©es -->
            <div class="card">
                <h3 class="card-title">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    M√©tadonn√©es
                </h3>
                
                {% if contrat.cree_par %}
                <div class="info-item" style="margin-bottom: 1rem;">
                    <div class="info-label">Cr√©√© par</div>
                    <div class="info-value">{{ contrat.cree_par.get_full_name|default:contrat.cree_par.username }}</div>
                </div>
                {% endif %}
                
                <div class="info-item" style="margin-bottom: 1rem;">
                    <div class="info-label">Date de cr√©ation</div>
                    <div class="info-value">{{ contrat.date_creation|date:"d/m/Y H:i" }}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Derni√®re modification</div>
                    <div class="info-value">{{ contrat.date_modification|date:"d/m/Y H:i" }}</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}